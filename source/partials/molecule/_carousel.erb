<%#
Carousel
Provides a UX tool to move between many images or media elements

@usage
Carousel
= partial 'partials/molecule/carousel.erb', locals: {
  array: [ { image: { extraClass: 'img-responsive', src: lorem.image('820x400', 'random_color': true, text: 'Carousel 1') } } ] }

@author Ian Warner <ian.warner@drykiss.com>
@category molecule

@see http://getbootstrap.com/javascript/#carousel
%>

<%# Variable %>
<%
id = locals[:id] || 'myCarousel'
data = locals[:data] || nil
key = locals[:key] || 'root'
%>

<%# Carousel %>
<div class="carousel slide <%= id %>" id="<%= id %>" data="<%= data %>">

  <%# Check we want indicators %>
  <% if locals[ :indicator ] %>

    <%# Indicators %>
    <ol class="carousel-indicators">

      <%# Array %>
      <% locals[:array].each_with_index do |slide, i| %>

        <%# If this is the first slide make it active %>
        <li class="<%= i == 0 ? 'active' : false %>" data-target="<%= "." + id %>" data-slide-to="<%= i %>"></li>

      <% end %>

    </ol>

  <% end %>

  <%# Inner Content %>
  <div class="carousel-inner" role="listbox">

    <%# Array loop %>
    <% locals[:array].each_with_index do |slide, i| %>

      <%#Â Image %>
      <%
      image = slide[:image]
      itemClass = image[:itemClass] || nil
      attribute = {
        class: "item #{i == 0 ? "#{itemClass} active" : itemClass}",
        ng: { swipe: { right: "#{key}.carouselSwipePrev($event)", left: "#{key}.carouselSwipeNext($event)" } },
        data: image[:data] || nil
      }
      %>

      <%# If this is the first slide make it active %>
      <% content_tag(:div, attribute) do %>

        <%# Image - make sure there is a src %>
        <% if image[:src] %>

          <%# Default alternative text if not found %>
          <% if !image[:alt] %>
            <% image[:alt] = "Carousel #{i}" %>
          <% end %>

          <%# Image %>
          <%= partial 'partials/atom/image.erb', locals: image %>

        <% end %>

        <%# Caption %>
        <% if image[:carouselCaption] %>

          <%# Caption %>
          <% caption = image[:carouselCaption] %>

          <%# Caption %>
          <div class="carousel-caption">

            <%# Tag %>
            <% caption[:tag] = caption[:tag] || 'h3' %>

            <%# Heading %>
            <%= partial 'partials/molecule/heading.erb', locals: caption %>

            <%# Body %>
            <% if caption[:body] %>
              <p>
                <%= caption[:body] %>
              </p>
            <% end %>

            <%# Button %>
            <% if caption[:button] %>
              <%= partial 'partials/atom/button.erb', locals: caption[:button] %>
            <% end %>

          </div>

        <% end %>

      <% end %>

    <% end %>

  </div>

  <%# Controls %>
  <% if locals[:control] %>

    <%# Previous - left control %>
    <% link_to("#carousel", class: 'carousel-control left', data: { slide: 'prev' }, role: 'button', ng: { click: "#{key}.carouselPrev($event)" } ) do %>
      <span class="fa-angle-left" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    <% end %>

    <%# Next - right control %>
    <% link_to("#carousel", class: 'carousel-control right', data: { slide: 'next' }, role: 'button', ng: { click: "#{key}.carouselNext($event)" } ) do %>
      <span class="fa-angle-right" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    <% end %>

  <% end %>

</div>
